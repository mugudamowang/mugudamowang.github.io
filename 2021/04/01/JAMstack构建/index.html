<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="&#34;auto&#34;"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png"><link rel="icon" href="/img/favicon.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="description" content="mugu的blog，记录下生活与web"><meta name="author" content="mugu"><meta name="keywords" content="mugu,web前端,博客"><title>JAMstack构建-Hexo+Netlify - mugu&#39;s blog</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css"><link rel="stylesheet" href="/lib/hint/hint.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/github-gist.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css"><link rel="stylesheet" href="/css/main.css"><script id="fluid-configs">var Fluid=window.Fluid||{},CONFIG={hostname:"www.bukun.top",root:"/",version:"1.8.9-a",typing:{enable:!0,typeSpeed:70,cursorChar:"⭐",loop:!1},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"right",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},copy_btn:!0,image_zoom:{enable:!0},toc:{enable:!0,headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:"ture",baidu:16490234,google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:"954aMCQyBcub7AHBudToJFGC-gzGzoHsz",app_key:"jCOdkXkpl3gRKOyLnnVXJIvJ",server_url:null}}}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 5.4.0"></head><body><header style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/">&nbsp;<strong>Oliver</strong>&nbsp;</a> <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> 首页</a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> 归档</a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> 分类</a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> 标签</a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> 关于</a></li><li class="nav-item" id="search-btn"><a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" href="javascript:">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div class="banner" id="banner" parallax="true" style="background:url(/img/default.png) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="page-header text-center fade-in-up"><span class="h2" id="subtitle" title="JAMstack构建-Hexo+Netlify"></span><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2021-04-01 12:52" pubdate>2021年4月1日 下午</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 2.2k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 23 分钟 </span><span id="busuanzi_container_page_pv" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="busuanzi_value_page_pv"></span> 次</span></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div class="py-5" id="board"><article class="post-content mx-auto"><h1 style="display:none">JAMstack构建-Hexo+Netlify</h1><p class="note note-info">本文最后更新于：2021年4月1日 下午</p><div class="markdown-body"><p>转载注明作者和出处, peace~</p><h2 id="首先-什么是-JAMstack"><a href="#首先-什么是-JAMstack" class="headerlink" title="首先, 什么是 JAMstack ?"></a>首先, 什么是 JAMstack ?</h2><p><strong>JAMstack就是 javascript + apis + makeup</strong></p><p>其中js处理动态显示的部分; APIS则是一些可重用的API, 比如一些云函数和第三方服务; Makeup就是用来生成站点的模板了. 近年在国外发展势头迅猛.</p><p><strong>一句话就是增强版的静态网站</strong>.</p><p><strong>基本理念</strong>就是提供更加简便迅速的开发体验; 因为这种模式以<strong>更低的成本, 更高的性能和更好的伸缩性</strong>让jamstack在网站构建方案中脱颖而出.</p><blockquote><ul><li>更好性能: 通过CDN分发静态资源等内容</li><li>更加安全: 没有传统的web服务器, 不需要担心常见的网络攻击</li><li>更方便: 直接托管在相应的服务中, 而且很便宜甚至免费, 比如githubpage/netlify, 国内的有gitee和腾讯云等都有相关服务</li><li>更加分离: 不需要限制在传统的开发体系中, 做到敏捷开发部署, 实时预览</li><li>更有伸缩性: 依托在CDN网络上, 网络性能伸缩性很好, 不需要担心传统服务器性能受限等问题.</li></ul></blockquote><p><strong>使用技巧</strong></p><blockquote><ul><li>CDN</li><li>原子发布: 每一次发布都是一次独立版本</li><li>无效缓存, 一旦重新发布, CDN就会更新原来的资源</li><li>通过版本系统控制, 如git, 轻易追踪文件地改动</li><li>自动构建: 当网站发布时, 通过webhook通知sever进行构建, server会构建项目并且更新CDN</li></ul></blockquote><p><strong>常见的构建方式</strong></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> 先本地开发, 现在一般通过静态站点生成器SSG如Hexo, Hugo, Getsby,Next等去生成静态资源. 我用的Hexo是使用Markdown文档作为模板输入而生成静态网页资源.<br><br><span class="hljs-bullet">2.</span> 版本控制系统如git进行管理, 一般这些SSG都会有相应的集成, 发布到远程仓库如github<br><br><span class="hljs-bullet">3.</span> 之后可以托管这些静态资源到相应的服务提供商上, 由他们曲部署构建和更新CDN, 常见有githubPage, Netlify, 国内的话可以用giteePage或者腾讯云的托管.<br><br></code></pre></td></tr></table></figure><p>当然上面这些提到的都是静态资源的部分, 那么如果有一些动态更新的地方, 就可以通过第三方API和云函数实现动态调用.</p><p><strong>一般有</strong></p><blockquote><ul><li>云开发: 添加自定义的云函数, 如腾讯云开发/netlify funciton/AWS; 可以添加云数据库来存储用户数据等.</li><li>评论: 有很多相关的评论服务可以使用, 如valine/twikoo/gittalk等. 一般一些JAMstack产品都会提供</li><li>其他: 搜索服务/表单服务/统计脚本/电子商务.</li></ul></blockquote><p>此外还有一种究极省事的方式, 就是通过CMS去完成内容管理和自动部署, 这种被叫做无头CMS, 如语雀/notion一类的内容管理平台.</p><p>这种CMS 系统<strong>会对外提供 API</strong>，网站生成器可以调用这些 API 拉取数据，<strong>将动态数据渲染成为静态页面</strong></p><p>这样内容创作者只需要专注于内容而不需要花费大量精力在web构建上.</p><p><strong>相比较传统类型构建方案</strong></p><table><thead><tr><th>类型</th><th>JAMstack的优势</th></tr></thead><tbody><tr><td>纯静态</td><td>JAMstack在纯静态上做了动态处理和内容管理上的增强, 所以相比纯静态, 交互性和管理体验更好</td></tr><tr><td>传统前端-后台服务器模式</td><td>在安全性/速度/可伸缩性上无可比拟. 传统的模式需要一个在线的服务器实时渲染和提供页面数据, 对于突变的请求量则很难控制, 而且扩容迁移都比较麻烦. JAMstack使用CDN分发静态页面, 这是太最大的优势</td></tr><tr><td>SPA</td><td>SPA的强大有目共睹, 当时缺点也很明显, 那就是SEO不友好, 即使现状有所改善, 但也无法避免性能问题.</td></tr></tbody></table><p><strong>JAMstack适用场景</strong></p><blockquote><ul><li>大量静态内容</li><li>如wiki, 博客网站, 文档, 电商网站, 企业官网等</li></ul></blockquote><p><strong>不适用</strong></p><blockquote><ul><li>大量动态更新内容</li><li>如聊天室\视频直播\论坛等.</li></ul></blockquote><h2 id="本博客的JAMstack构建方案"><a href="#本博客的JAMstack构建方案" class="headerlink" title="本博客的JAMstack构建方案"></a>本博客的JAMstack构建方案</h2><p>博主经历了<code>githupage--&gt;giteePage--&gt;Netfily</code>的艰辛构建史.</p><p>期间升级了一次<code>Hexo3.2.0--&gt;Hexo5.4.0</code>,</p><p>以及主题版本<code>Fluid--&gt;1.89</code>.</p><p><strong>本方案适合几乎无费用/访问量一般的阶段使用, 全部<s>白嫖</s> XD</strong></p><p>目前使用的构建方案是:</p><blockquote><ol><li>SSG框架: Hexo5.4.0</li><li>版本控制: git, github</li><li>免费托管服务: Netlify</li><li>免费第三方API和公共CDN: jsdelivr , Leancloud</li></ol></blockquote><p>使用Hexo主题<code>Fluid</code>中集成了一些<code>Jsdelivr</code>的公共CDN, 并提供了<code>Leancloud</code>的评论接口, 非常nice!</p><p>因为是博客网站, 所以需要的动态服务不多, 最主要的是评论和访问统计, 这一块的配置方案建议使用<strong>基于Leancloud的Valine评论系统, PV统计建议使用不蒜子, 特别省心</strong>. 而且同第三方库可以是实现邮件通知等功能.</p><p>所以第一步就是去Hexo文档去<strong>构建部署自己的站点</strong>, 之后选择Fluid或者其他<strong>主题进行配置</strong>.</p><p><a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/">1. Hexo</a></p><p><a target="_blank" rel="noopener" href="https://github.com/fluid-dev/hexo-theme-fluid">2. hexo 主题: Fluid</a></p><p><a target="_blank" rel="noopener" href="https://valine.js.org/">3. valine无后端评论系统</a></p><p><a target="_blank" rel="noopener" href="https://busuanzi.ibruce.info/">4. 不蒜子极简统计</a></p><p>PS: 截至目前博客访问量🎉🎉</p><p><img src="https://i.loli.net/2021/04/01/tZmDjQFWClocUOX.png" srcset="/img/loading.gif" lazyload alt="image-20210401135558131"></p><p>托管服务使用Netlify, 太香了~. <strong>之前使用的是githubPage托管, 图个省心, 奈何首屏要11s</strong>, 简直是上古时代的速度😂, 果断放弃. 之后尝试了giteePage的托管, 效果和Netlify差不多, 前面一个是Gitee后面一个是Netfily:</p><p><img src="https://i.loli.net/2021/04/01/76AhUdHOwXxt4fo.png" srcset="/img/loading.gif" lazyload alt="image-20210401132713843"></p><p><img src="C:\Users\Mr.yang\AppData\Roaming\Typora\typora-user-images\image-20210401132634558.png" srcset="/img/loading.gif" lazyload alt="image-20210401132634558"></p><p>相比下giteePage速度更快一些, 毕竟是国内托管服务. 但是最蛋疼的是, <strong>它要<code>PRO</code>才能自定义域名</strong>, <s>不能白嫖</s>, 这不符合我geek的精神. 如果不介意的话giteePage倒是不错的选择.</p><p><img src="https://i.loli.net/2021/04/01/NOpAiwlzhFLJH42.png" srcset="/img/loading.gif" lazyload alt="image-20210401133128209">❌</p><p><img src="https://i.loli.net/2021/04/01/sXicz4ykYEKT2ab.png" srcset="/img/loading.gif" lazyload alt="image-20210401133154722">✔</p><p>到阿里云等买一个域名(这个12块钱一年🤣), <strong>Netlify和githubPag而都支持自定义域名绑定</strong>, 只要到相应的提供商哪里解析一下DNS即可.</p><p><a target="_blank" rel="noopener" href="https://wanwang.aliyun.com/domain/">阿里云域名注册</a></p><p>不过有个坑🕳, 就是使用了不带www的二级域名<strong>会让Leancloud的PV和UV计数失效. 而且邮件提醒功能也无法进行</strong>, 非常蛋疼. 当然这是白嫖下的妥协, 如果不想要www, 可以通过氪金解决.</p><p><a target="_blank" rel="noopener" href="https://valine.js.org/notify.html">设置valine邮件提醒</a></p><p><strong>而且, 选择Netfily可以直接监管github仓库的更新</strong>, 这样Hexo + github + Netlify + Leancloud的一条龙方案特别nice~.</p><p>当然也可以尝试使用其他托管服务, 这里仅仅是博主个人使用过的做分享.</p><p><a target="_blank" rel="noopener" href="https://netlify.com/">Netlify</a></p><p><a target="_blank" rel="noopener" href="https://gitee.com/help/articles/4136">giteePage</a></p><p><a target="_blank" rel="noopener" href="https://sspai.com/post/54608">githubPage</a></p><h2 id="优化方案"><a href="#优化方案" class="headerlink" title="优化方案"></a>优化方案</h2><p>大体上针对JAMstack的优化是CDN服务的优化和文件压缩. 而且也有很多现成插件可以在构建前打包, 非常便捷! 经过测试, 优化之后加载速度快了近一倍~.</p><p>以下是最新版本Fluid的优化方案:</p><ul><li><p>压缩图片</p><ul><li>可以使用Fluid中内置的压缩功能</li><li>使用hexo-all-minifier</li><li>使用TinyPing等第三方压缩之后再上传.</li></ul></li><li><p>压缩生成文件</p><p>通过hexo-all-minifier压缩生成的前端静态文件和图片</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install hexo-all-minifier<br><br><span class="hljs-comment">### 在博客_config.yml中设置</span><br>all-minifier: <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>其中自定义启动concator:</p><ul><li>js_concator将生成的js合并, 打包成一个脚本文件并放在页面末尾, 以此减少请求数量和避免阻塞</li><li>bug: 使用js_concator打包之侯会让评论插件不可用, 可能是APIs与其冲突了.</li></ul></li><li><p>使用 CDN服务</p><p>hexo-fluid默认使用了jsDelivr服务, 将常用的第三方库配置公共 CDN</p><ul><li>也可以使用staticfile\bootcdn等</li><li>可以购买私有CDN进行加速, <a target="_blank" rel="noopener" href="https://www.julydate.com/post/60859300">cdn</a></li></ul></li></ul><p>以前弄过WordPress那一套, 太憋屈, 老是要安装各种插件, 一个贫民服务器还经常搞崩, 没钱购买安全防护就得承受到web攻击, 速度还一般. 通过简单的配置和加载优化就可以使用上和以前要花费大价钱配置的网站同样的体验, 美哉美哉.</p><p><strong>所以对于博客网站来说, JAMstack YES!</strong></p><h2 id="核心概念-CDN"><a href="#核心概念-CDN" class="headerlink" title="核心概念-CDN"></a>核心概念-CDN</h2><p>内容交付网络（CDN）是指一组在地理上分散的服务器，它们协同工作以提供互联网内容的快速交付。</p><p>CDN允许快速转移加载互联网内容所需的资产，包括HTML页面、javascript 文件、样式表、图像和视频。 CDN服务的受欢迎程度持续增长。如今，大多数网页流量都通过CDN提供服务，包括来自Facebook、奈飞和亚马逊等主要网站的流量。</p><p><a target="_blank" rel="noopener" href="https://www.cloudflare.com/zh-cn/learning/cdn/what-is-a-cdn/">more</a></p></div><hr><div><div class="post-metas mb-3"><div class="post-meta mr-3"><i class="iconfont icon-category"></i> <a class="hover-with-bg" href="/categories/%E5%89%8D%E7%AB%AF%E6%89%8B%E6%9C%AD/">前端手札</a></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a class="hover-with-bg" href="/tags/web/">web</a> <a class="hover-with-bg" href="/tags/JAMstack/">JAMstack</a></div></div><p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p><div class="post-prevnext"><article class="post-prev col-6"></article><article class="post-next col-6"><a href="/2021/03/15/%E9%87%8D%E5%AD%A6%E5%89%8D%E7%AB%AF-HTML/"><span class="hidden-mobile">前端二向箔-HTML</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article class="comments" id="comments" lazyload><div id="valine"></div><script type="text/javascript">Fluid.utils.lazyComments("valine",(function(){Fluid.utils.createScript("https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js",(function(){new Valine({el:"#valine",app_id:"954aMCQyBcub7AHBudToJFGC-gzGzoHsz",app_key:"jCOdkXkpl3gRKOyLnnVXJIvJ",placeholder:"哎一古!",path:window.location.pathname,avatar:"retro",meta:["nick","mail","link"],pageSize:"10",lang:"zh-CN",highlight:!1,recordIP:!0,serverURLs:""})}))}))</script><noscript>Please enable JavaScript to view the <a target="_blank" href="https://valine.js.org" rel="nofollow noopener noopener">comments powered by Valine.</a></noscript></article></article></div></div></div><div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p><div class="toc-body" id="toc-body"></div></div></div></div></div><a id="scroll-top-button" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer class="text-center mt-5 py-3"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a></div><div class="statistics"><span id="busuanzi_container_site_pv" style="display:none">总访问量 <span id="busuanzi_value_site_pv"></span> 次 </span><span id="busuanzi_container_site_uv" style="display:none">总访客数 <span id="busuanzi_value_site_uv"></span> 人</span></div></footer><script src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js"></script><script src="/js/debouncer.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="/js/img-lazyload.js"></script><script src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script><script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script defer src="/js/leancloud.js"></script><script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js"></script><script>!function(t,i){(0,Fluid.plugins.typing)(i.getElementById("subtitle").title)}(window,document)</script><script src="/js/local-search.js"></script><script>$("#local-search-input").on("click",(function(){searchFunc("/local-search.xml","local-search-input","local-search-result")})),$("#modalSearch").on("shown.bs.modal",(function(){$("#local-search-input").focus()}))</script><script defer>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?16490234";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script src="/js/boot.js"></script></body></html>